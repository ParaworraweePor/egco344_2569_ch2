<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Electricity Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="style.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>

<header>
  <h1 id="title">Electricity Dashboard</h1>
  <p id="subtitle">Loading…</p>
</header>

<main>

  <!-- KPI summary -->
  <section class="kpi-grid" id="kpis"></section>

  <!-- Charts -->
  <section class="chart-grid">
    <div class="card">
      <h3>Electricity Usage by Category (kWh)</h3>
      <canvas id="usageChart"></canvas>
    </div>

    <div class="card">
      <h3>Number of Users by Category</h3>
      <canvas id="userChart"></canvas>
    </div>
  </section>

  <!-- Table -->
  <table id="dataTable">
    <thead>
      <tr>
        <th>Category</th>
        <th class="right">Usage (kWh)</th>
        <th class="right">Users</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

</main>

<script>
async function loadData() {
  const [usageRes, userRes] = await Promise.all([
    fetch('electricity_usages_en.json'),
    fetch('electricity_users_en.json')
  ]);
/** 
 * A
 * 
 * H
 * U
 * G
 * E
 * 
 * M
 * I
 * S
 * T
 * A
 * K
 * E  
**/
  const usage = await usageRes.json();
  const users = await userRes.json();

  document.getElementById('title').textContent =
    `Electricity Dashboard – ${usage.province_name}`;

  document.getElementById('subtitle').textContent =
    `Year ${usage.year} | Province Code ${usage.province_code}`;

  const categories = [
    ['Residential', 'residential'],
    ['Small Business', 'small_business'],
    ['Medium Business', 'medium_business'],
    ['Large Business', 'large_business'],
    ['Specialized Business', 'specialized_business'],
    ['Public Electricity', 'public_electricity'],
    ['Temporary Electricity', 'temporary_electricity'],
    ['EV Charging', 'ev_charging']
  ];

  const usageValues = [];
  const userValues = [];
  const labels = [];

  let totalUsage = 0;
  let totalUsers = 0;

  const tbody = document.querySelector('#dataTable tbody');

  categories.forEach(([label, key]) => {
    const u = usage[`${key}_kwh`] || 0;
    const c = users[`${key}_count`] || 0;

    labels.push(label);
    usageValues.push(u);
    userValues.push(c);

    totalUsage += u;
    totalUsers += c;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${label}</td>
      <td class="right">${u.toLocaleString()}</td>
      <td class="right">${c.toLocaleString()}</td>
    `;
    tbody.appendChild(tr);
  });

  // KPI cards
  const kpis = document.getElementById('kpis');
  kpis.innerHTML = `
    <div class="card">
      <h3>Total Usage</h3>
      <div class="value">${totalUsage.toLocaleString()} kWh</div>
    </div>
    <div class="card">
      <h3>Total Users</h3>
      <div class="value">${totalUsers.toLocaleString()}</div>
    </div>
    <div class="card">
      <h3>Avg Usage / User</h3>
      <div class="value">${Math.round(totalUsage / totalUsers).toLocaleString()} kWh</div>
    </div>
  `;

  // Charts
  new Chart(document.getElementById('usageChart'), {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label: 'kWh',
        data: usageValues
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      }
    }
  });

  new Chart(document.getElementById('userChart'), {
    type: 'pie',
    data: {
      labels,
      datasets: [{
        data: userValues
      }]
    },
    options: {
      responsive: true
    }
  });
}

loadData().catch(err => {
  document.getElementById('subtitle').textContent = 'Failed to load data';
  console.error(err);
});
</script>

</body>
</html>