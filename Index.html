<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Electricity Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --primary: #2563eb;
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    header {
      padding: 1.2rem;
      background: var(--primary);
      color: white;
    }

    header h1 {
      margin: 0;
      font-size: 1.4rem;
    }

    header p {
      margin: 0.2rem 0 0;
      opacity: 0.9;
    }

    main {
      padding: 1rem;
      max-width: 1200px;
      margin: auto;
    }

    /* KPI cards */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    .card h3 {
      margin: 0;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .card .value {
      margin-top: 0.4rem;
      font-size: 1.3rem;
      font-weight: 700;
    }

    /* Charts */
    .chart-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    @media (min-width: 768px) {
      .chart-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    /* Table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1.5rem;
      background: var(--card);
      border-radius: 12px;
      overflow: hidden;
    }

    th, td {
      padding: 0.75rem;
      text-align: left;
      font-size: 0.9rem;
    }

    th {
      background: #f1f5f9;
      color: #334155;
    }

    tr:not(:last-child) {
      border-bottom: 1px solid #e2e8f0;
    }

    .right {
      text-align: right;
    }
  </style>
</head>
<body>

<header>
  <h1 id="title">Electricity Dashboard</h1>
  <p id="subtitle">Loading…</p>
</header>

<main>

  <!-- KPI summary -->
  <section class="kpi-grid" id="kpis"></section>

  <!-- Charts -->
  <section class="chart-grid">
    <div class="card">
      <h3>Electricity Usage by Category (kWh)</h3>
      <canvas id="usageChart"></canvas>
    </div>

    <div class="card">
      <h3>Number of Users by Category</h3>
      <canvas id="userChart"></canvas>
    </div>
  </section>

  <!-- Table -->
  <table id="dataTable">
    <thead>
      <tr>
        <th>Category</th>
        <th class="right">Usage (kWh)</th>
        <th class="right">Users</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

</main>

<script>
async function loadData() {
  const [usageRes, userRes] = await Promise.all([
    fetch('electricity_usages_en.json'),
    fetch('electricity_users_en.json')
  ]);

  const usage = await usageRes.json();
  const users = await userRes.json();

  document.getElementById('title').textContent =
    `Electricity Dashboard – ${usage.province_name}`;

  document.getElementById('subtitle').textContent =
    `Year ${usage.year} | Province Code ${usage.province_code}`;

  const categories = [
    ['Residential', 'residential'],
    ['Small Business', 'small_business'],
    ['Medium Business', 'medium_business'],
    ['Large Business', 'large_business'],
    ['Specialized Business', 'specialized_business'],
    ['Public Electricity', 'public_electricity'],
    ['Temporary Electricity', 'temporary_electricity'],
    ['EV Charging', 'ev_charging']
  ];

  const usageValues = [];
  const userValues = [];
  const labels = [];

  let totalUsage = 0;
  let totalUsers = 0;

  const tbody = document.querySelector('#dataTable tbody');

  categories.forEach(([label, key]) => {
    const u = usage[`${key}_kwh`] || 0;
    const c = users[`${key}_count`] || 0;

    labels.push(label);
    usageValues.push(u);
    userValues.push(c);

    totalUsage += u;
    totalUsers += c;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${label}</td>
      <td class="right">${u.toLocaleString()}</td>
      <td class="right">${c.toLocaleString()}</td>
    `;
    tbody.appendChild(tr);
  });

  // KPI cards
  const kpis = document.getElementById('kpis');
  kpis.innerHTML = `
    <div class="card">
      <h3>Total Usage</h3>
      <div class="value">${totalUsage.toLocaleString()} kWh</div>
    </div>
    <div class="card">
      <h3>Total Users</h3>
      <div class="value">${totalUsers.toLocaleString()}</div>
    </div>
    <div class="card">
      <h3>Avg Usage / User</h3>
      <div class="value">${Math.round(totalUsage / totalUsers).toLocaleString()} kWh</div>
    </div>
  `;

  // Charts
  new Chart(document.getElementById('usageChart'), {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label: 'kWh',
        data: usageValues
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      }
    }
  });

  new Chart(document.getElementById('userChart'), {
    type: 'pie',
    data: {
      labels,
      datasets: [{
        data: userValues
      }]
    },
    options: {
      responsive: true
    }
  });
}

loadData().catch(err => {
  document.getElementById('subtitle').textContent = 'Failed to load data';
  console.error(err);
});
</script>

</body>
</html>